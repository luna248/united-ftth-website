<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCjjNEOwpfvtNcLU_8c3HO4_Emkac2zyiA",
    authDomain: "united-ftth.firebaseapp.com",
    projectId: "united-ftth",
    storageBucket: "united-ftth.firebasestorage.app",
    messagingSenderId: "428670772093",
    appId: "1:428670772093:web:335202a62c96361539e214",
    measurementId: "G-N9R65K4X68"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
    (function() {
    emailjs.init("MGsFicpPEn5FqLCT1"); // ⬅️ שים כאן את ה־Public Key שלך
    })();
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>יונייטד - אינטרנט בסיבים אופטיים</title>
    <style>
        :root {
            --primary: #5c2d91;
            --secondary: #3a1d6d;
            --light: #f4f4f9;
            --dark: #333;
            --success: #5c2d91;
            --warning: #ffc107;
            --danger: #dc3545;
        }
        body {
            font-family: 'Varela Round', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light);
            color: var(--dark);
        }
        header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        .main-logo {
            display: block;
            margin: 2rem auto;
            max-width: 500px;
            width: 100%;
        }
        nav {
            display: flex;
            justify-content: center;
            background: var(--secondary);
            padding: 0.5rem;
            flex-wrap: wrap;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
            padding: 0.5rem;
            white-space: nowrap;
        }
        nav a:hover {
            background: #004080;
        }
        .container {
            padding: 2rem;
            max-width: 1200px;
            margin: auto;
            padding-bottom: 6rem;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            margin: 0.5rem;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #004080;
            transform: translateY(-2px);
        }
        .btn-success {
            background: var(--success);
        }
        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }
        .btn-danger {
            background: var(--danger);
        }
        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 14px;
        }
        form {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 2rem auto;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: all 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .status-badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        .status-completed {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        .status-canceled {
            background-color: #f8d7da;
            color: #721c24;
        }
        footer {
            background: var(--secondary);
            color: white;
            text-align: center;
            padding: 1.5rem;
            width: 100%;
            position: fixed;
            bottom: 0;
        }
        .hidden {
            display: none;
        }
        .tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            border-bottom-color: var(--primary);
            font-weight: bold;
        }
        .tech-schedule {
            margin-top: 2rem;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
        }
        .schedule-day {
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 5px;
        }
        .time-slot {
            padding: 0.5rem;
            margin: 0.3rem 0;
            border-radius: 3px;
            cursor: pointer;
        }
        .time-slot.available {
            background: #e6f7ff;
        }
        .time-slot.booked {
            background: #ffcccc;
            cursor: not-allowed;
        }
        .time-slot.selected {
            background: #b3e0ff;
            font-weight: bold;
        }
        .package {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .package h3 {
            color: var(--primary);
            margin-top: 0;
        }
        .package-features {
            margin: 1rem 0;
        }
        .package-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--success);
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .schedule-grid {
                grid-template-columns: 1fr;
            }
        }
    
        .fade-in {
            opacity: 0;
            animation: fadeIn 1.2s ease-in-out forwards;
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

    
        .wifi-button {
            background-color: #007bff;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border: none;
            cursor: pointer;
            animation: pulse 1.5s infinite;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0,123,255, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0,123,255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0,123,255, 0); }
        }

    
        .location-tag {
            background-color: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: bold;
        }

    </style>
</head>
<body>
    <header>
        <h1 class="fade-in">יונייטד - אינטרנט בסיבים אופטיים</h1>
        <p class="fade-in" style="animation-delay: 0.3s;">החיבור המהיר והאמין ביותר לבית שלך</p>
    </header>
    <nav>
        <a href="#" onclick="showSection('home')">דף הבית</a>
        <a href="#" onclick="showSection('packages')">חבילות אינטרנט</a>
        <a href="#" onclick="showSection('contact')">פניות</a>
        <a href="#" onclick="showSection('check-status')">בדיקת סטטוס</a>
        <a href="#" onclick="showSection('admin-login')" id="admin-link">כניסת עובד</a>
    </nav>
    <div class="container">
        <!-- דף הבית -->
        <section id="home">


            <img src="יונייטיד לוגו.png" 
                 alt="לוגו יונייטד" class="main-logo">
            
            
<div class="card">
    <h2 style="text-align: center; cursor: pointer;" onclick="toggleCollapse('aboutText')">מי אנחנו?</h2>
    <div id="aboutText" style="display: none; margin-top: 1rem;">
        <p>
            יונייטד היא חברת תקשורת מובילה המתמחה בהתקנת תשתיות סיבים אופטיים מתקדמות (FTTH - Fiber To The Home).
            אנו מספקים את החיבור המהיר, האמין והאיכותי ביותר לבתים ולעסקים ברחבי הארץ.
        </p>
        <p>
            עם רשת הסיבים האופטיים שלנו, תוכלו ליהנות מחוויית גלישה חלקה ללא הפרעות,
            המתאימה לכל הצרכים הדיגיטליים של המשפחה המודרנית - צפייה בסרטונים באיכות 4K,
            משחקים אונליין, עבודה מהבית ועוד.
        </p>
    </div>
</div>
<div style="text-align: center; margin-top: 1.5rem;">
    <button class="btn wifi-button" onclick="window.open('https://unlimited.speedtestcustom.com/result/cf8928d0-0e3a-11f0-a870-bd7c41d08bd5', '_blank')">
        📶 בדוק!
    </button>
</div>



<div class="card" style="margin-top: 2rem;">
    <h2 style="text-align: center;">בדוק אם אנחנו מגיעים אליך</h2>
    <div style="text-align: center; margin: 1.5rem 0;">
        <input type="text" id="citySearch" placeholder="הקלד/י את שם היישוב..." 
            style="padding: 0.7rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 10px; width: 80%; max-width: 400px; text-align: center;">
        <div id="searchResult" style="margin-top: 1rem; font-size: 1.1rem; font-weight: bold; color: var(--primary);"></div>
    </div>
</div>
<script>
    const supportedCities = [
        "ג'לג'וליה","טייבה","קלנסווה","ערערה","עארה","פראדיס",
        "אעבלין","טמרה","מג'ד אלכרום","שפרעם","אום לפחם",
        "כפר כמא","עין מאהל","ביר אלמכסור","טורעאן","זרזיר"
    ];

    document.getElementById('citySearch').addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            const input = this.value.trim();
            const result = document.getElementById('searchResult');
            if (!input) {
                result.innerHTML = '';
                return;
            }

            const matched = supportedCities.includes(input);
            if (matched) {
                result.innerHTML = '✅ כן! תבחר חבילה ואנחנו בדרך אליך 🚀<br><a href="#" onclick="showSection(\'packages\')" style="color: var(--primary); text-decoration: underline;">לחץ כאן להצגת חבילות</a>';
            } else {
                result.innerHTML = '❌ אופס... עוד לא הגענו לשם 😢';
            }
        }
    });
</script>


    </div>
</div>

                
                
                
            </div>
        



</section>

        <!-- חבילות אינטרנט -->
        
<section id="packages" class="hidden" style="max-height: 100vh; overflow-y: auto; padding-bottom: 3rem;">
    <h2 style="text-align: center; font-size: 2.2rem; color: var(--primary); margin-bottom: 2rem;">בחרו את החבילה שמתאימה לכם</h2>
    <div class="grid">
        <div class="card" style="border-top: 6px solid var(--primary); text-align: center;">
            <h3 style="color: var(--primary); font-size: 1.6rem;">הכי פופולרית</h3>
            <p style="margin: 0.5rem 0;">1000 מגה הורדה / 250 העלאה</p><p style="color: #555;">החבילה המהירה ביותר שלנו – מומלצת לעסקים וללקוחות פרטיים שדורשים ביצועים מקסימליים.</p>
            <p style="color: var(--success); font-weight: bold; font-size: 1.3rem;">135 ש"ח לחודש</p>
            <ul style="list-style: none; padding: 0; margin: 1rem 0; color: #555;">
                <li>✅ סיב אופטי עד הבית (FTTH)</li>
                <li>✅ נתב מתקדם כלול</li>
                <li>✅ תמיכה טכנית 24/7</li>
            </ul>
            <button class="btn" onclick="showSection('contact')">הזמן עכשיו</button>
        </div>

        <div class="card" style="border-top: 6px solid #8e44ad; text-align: center;">
            <h3 style="color: #8e44ad; font-size: 1.6rem;">מהיר וחכם</h3>
            <p style="margin: 0.5rem 0;">1000 מגה הורדה / 100 העלאה</p><p style="color: #555;">חבילה מאוזנת, מהירה וחסכונית – אידיאלית לשימוש יומיומי אינטנסיבי בבית חכם.</p>
            <p style="color: var(--success); font-weight: bold; font-size: 1.3rem;">125 ש"ח לחודש</p>
            <ul style="list-style: none; padding: 0; margin: 1rem 0; color: #555;">
                <li>✅ סיב אופטי עד הבית (FTTH)</li>
                <li>✅ נתב מתקדם כלול</li>
                <li>✅ תמיכה טכנית 24/7</li>
            </ul>
            <button class="btn" onclick="showSection('contact')">הזמן עכשיו</button>
        </div>

        <div class="card" style="border-top: 6px solid #3498db; text-align: center;">
            <h3 style="color: #3498db; font-size: 1.6rem;">סטנדרט פלוס</h3>
            <p style="margin: 0.5rem 0;">500 מגה הורדה / 100 העלאה</p><p style="color: #555;">חבילה מהירה, משתלמת ונגישה – מתאימה במיוחד ללקוחות פרטיים עם צרכים מגוונים.</p>
            <p style="color: var(--success); font-weight: bold; font-size: 1.3rem;">115 ש"ח לחודש</p>
            <ul style="list-style: none; padding: 0; margin: 1rem 0; color: #555;">
                <li>✅ סיב אופטי עד הבית (FTTH)</li>
                <li>✅ נתב מתקדם כלול</li>
                <li>✅ תמיכה טכנית 24/7</li>
            </ul>
            <button class="btn" onclick="showSection('contact')">הזמן עכשיו</button>
        </div>
    </div>
</section>


        <!-- פניות -->
        
<section id="contact" class="hidden">
    <div style="text-align: center; margin-bottom: 2rem;">
        <h2 style="font-size: 2.2rem; color: var(--primary); margin-bottom: 0.5rem;">השאר.י פרטים ונחזור אליך</h2>
        <p style="font-size: 1.1rem; color: #555;">צוות יונייטד כאן בשבילך – לשאלות, התקנות ותקלות</p>
    </div>
    <div class="card" style="max-width: 600px; margin: auto; padding: 2rem; background: #ffffffcc; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-radius: 12px;">
        <form id="contactForm">
            <div class="form-group">
                <label for="contactType">סוג הפנייה:</label>
                <select id="contactType" required onchange="updateContactForm()">
                    <option value="">בחר סוג פנייה</option>
                    <option value="new-installation">התקנה חדשה</option>
                    <option value="technical-issue">תקלה טכנית</option>
                    <option value="general-question">שאלה כללית</option>
                </select>
            </div>
            <div class="form-group">
                <label for="fullName">שם מלא:</label>
                <input type="text" id="fullName" required>
            </div>
            <div class="form-group">
                <label for="idNumber">מספר תעודת זהות:</label>
                <input type="text" id="idNumber" required>
            </div>
            <div class="form-group">
                <label for="phone">טלפון:</label>
                <input type="tel" id="phone" required>
            </div>
           <div class="form-group">
    <label for="email">אימייל:</label>
    <input type="email" id="email" required>
</div>


            <div class="form-group">
                <label for="address">כתובת:</label>
                <input type="text" id="address">
            </div>
            <div class="form-group">
                <label for="description">פירוט הפנייה:</label>
                <textarea id="description" rows="4" required></textarea>
            </div>
            <div class="form-group" style="text-align: center;">
                <button type="submit" class="btn" style="font-size: 18px;">שלח פנייה</button>
            </div>
        </form>
        <div id="contactResult" class="hidden" style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: #e6f4ff; border-radius: 8px;">
            <!-- כאן יוצג מספר הפנייה לאחר השליחה -->
        </div>
    </div>
</section>


        <!-- בדיקת סטטוס -->
        <section id="check-status" class="hidden">
            <div class="card">
                <h2 style="text-align: center;">בדיקת סטטוס בקשה</h2>
                <form id="statusForm">
                    <div class="form-group">
                        <label for="searchId">מספר הזמנה:</label>
                        <input type="text" id="searchId" required>
                    </div>
                    <div class="form-group" style="text-align: center;">
                        <button type="submit" class="btn">בדוק סטטוס</button>
                    </div>
                </form>
                
                <div id="statusResults" class="hidden">
                    <h3>סטטוס בקשות</h3>
                    <div id="requestsList"></div>
                </div>
            </div>
        </section>

        <!-- כניסת עובד -->
        <section id="admin-login" class="hidden">
            <div class="card">
                <h2 style="text-align: center;">כניסת עובד</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="username">שם משתמש:</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">סיסמה:</label>
                        <input type="password" id="password" required>
                    </div>
                    <div class="form-group" style="text-align: center;">
                        <button type="submit" class="btn">כניסה</button>
                    </div>
                </form>
            </div>
            
            <div id="admin-panel" class="hidden">
                <h2 style="text-align: center;">ממשק ניהול</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="showAdminTab('requests')">ניהול בקשות</div>
                    <div class="tab" onclick="showAdminTab('schedule')">לוח זמנים</div>
                </div>
                
                <div id="requests-tab">
                    <h3>בקשות לקוחות</h3>
                    <div class="grid" id="adminRequestsList"></div>
                </div>
                
                <div id="schedule-tab" class="hidden">
                    <h3>ניהול לוח זמנים</h3>
                    
                    <div class="form-group">
                        <label for="techSelect">בחר טכנאי:</label>
                        <select id="techSelect" onchange="loadTechSchedule()">
                            <option value="">בחר טכנאי</option>
                            <option value="1">דוד לוי</option>
                            <option value="2">שרה כהן</option>
                            <option value="3">משה ישראלי</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="scheduleDate">תאריך:</label>
                        <input type="date" id="scheduleDate" onchange="loadTechSchedule()">
                    </div>
                    
                    <div id="techScheduleContainer" class="tech-schedule">
                        <!-- כאן יטען לוח הזמנים של הטכנאי -->
                    </div>
                </div>
            </div>
        </section>
    </div>
    <footer>
        <p>© 2024 יונייטד - United. כל הזכויות שמורות. | טלפון: *8224 | דוא"ל: info@united.net.il</p>
    </footer>

    <script>
        function sendStatusUpdateEmail(request) {
    const customer = customers.find(c => c.id === request.customerId);
    if (!customer || !customer.email) return;

    const templateParams = {
        to_name: customer.fullName,
        to_email: customer.email,
        request_id: request.id,
        status_text: getStatusText(request.status),
        date: formatDisplayDate(new Date().toISOString()),
        feedback_link: "https://docs.google.com/forms/d/e/1FAIpQLSc6D7Fie06TWIQ-MIEw0QMOudWGONteyufk3tchVSgaCIOeDg/viewform?usp=dialog" // ⬅️ שים כאן את הקישור לסקר שלך ב-Google Forms
    };

    emailjs.send("service_ic5vgkc", "template_26m9trr", templateParams)
        .then(function(response) {
            console.log("Email sent:", response.status);
        }, function(error) {
            console.error("Email failed:", error);
        });
}

        // מאגר נתונים
        let requests = JSON.parse(localStorage.getItem('requests')) || [];
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let technicians = [
            { id: "1", name: "דוד לוי", schedule: {} },
            { id: "2", name: "שרה כהן", schedule: {} },
            { id: "3", name: "משה ישראלי", schedule: {} }
        ];
        let currentAdmin = null;
        
        // שעות עבודה אפשריות
        const workHours = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'];
        
        // אתחול המערכת
        document.addEventListener('DOMContentLoaded', function() {
            // טעינת נתונים אם קיימים
            if (localStorage.getItem('technicians')) {
                technicians = JSON.parse(localStorage.getItem('technicians'));
            }
            
            // הגדרת אירועים לטופסים
            document.getElementById('contactForm').addEventListener('submit', submitContactForm);
            document.getElementById('statusForm').addEventListener('submit', checkStatus);
            document.getElementById('adminLoginForm').addEventListener('submit', adminLogin);
            
            // הגדרת תאריך ברירת מחדל בלוח זמנים
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('scheduleDate').valueAsDate = tomorrow;
        });
        
        // פונקציות מעבר בין חלקים
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // אם זה ממשק הניהול ויש עובד מחובר
            if (sectionId === 'admin-login' && currentAdmin) {
                document.getElementById('admin-panel').classList.remove('hidden');
                showAdminTab('requests');
            }
        }
        
        function showAdminTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabId + '-tab').classList.remove('hidden');
            
            if (tabId === 'requests') {
                loadAdminRequests();
            } else if (tabId === 'schedule') {
                loadTechSchedule();
            }
        }
        
        // פונקציות לטופס פניות
        function updateContactForm() {
            // אפשר להוסיף לוגיקה ספציפית לפי סוג הפנייה
        }
        
        function submitContactForm(e) {
            e.preventDefault();
            
            const contactType = document.getElementById('contactType').value;
            const fullName = document.getElementById('fullName').value;
            const idNumber = document.getElementById('idNumber').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const address = document.getElementById('address').value;
            const description = document.getElementById('description').value;
            
            // יצירת מזהה ייחודי
            const requestId = 'REQ-' + Date.now().toString().slice(-6);
            
            // יצירת לקוח חדש אם לא קיים
            let customer = customers.find(c => c.idNumber === idNumber);
            if (!customer) {
                customer = {
                    id: 'CUST-' + Date.now().toString().slice(-6),
                    fullName,
                    idNumber,
                    phone,
                    email,
                    address,
                    requests: []
                };
                customers.push(customer);
            }
            
            // יצירת הבקשה
            const newRequest = {
                id: requestId,
                customerId: customer.id,
                type: contactType,
                description,
                status: 'pending',
                createdAt: new Date().toISOString(),
                technician: null,
                updates: []
            };
            
            requests.push(newRequest);
            customer.requests.push(requestId);
            saveRequestToFirestore(newRequest, customer);

            
            // שמירה ב-localStorage
            saveData();
            
            // הצגת הודעה למשתמש
            const contactResult = document.getElementById('contactResult');
            contactResult.innerHTML = `
                <h3>פנייתך התקבלה בהצלחה!</h3>
                <p>מספר הפנייה: <strong>${requestId}</strong></p>
                <p>ניתן לעקוב אחר סטטוס הפנייה במערכת המעקב.</p>
                <button class="btn" onclick="showSection('check-status')">בדוק סטטוס עכשיו</button>
            `;
            contactResult.classList.remove('hidden');
            
            // איפוס הטופס
            e.target.reset();
        }
        
        // פונקציות לבדיקת סטטוס
        function checkStatus(e) {
            e.preventDefault();
            
            const requestId = document.getElementById('searchId').value;
            const customerRequests = requests.filter(r => r.id === requestId);
            
            if (customerRequests.length === 0) {
                alert('לא נמצאה בקשה עם מספר הזמנה זה');
                return;
            }
            
            const resultsContainer = document.getElementById('requestsList');
            resultsContainer.innerHTML = '';
            
            if (customerRequests.length === 0) {
                resultsContainer.innerHTML = '<p>לא נמצאו בקשות עבור לקוח זה</p>';
            } else {
                customerRequests.forEach(request => {
                    const requestElement = document.createElement('div');
                    requestElement.className = 'card';
                    requestElement.style.marginBottom = '1rem';
                    
                    let statusClass = '';
                    switch(request.status) {
                        case 'pending': statusClass = 'status-pending'; break;
                        case 'approved': statusClass = 'status-approved'; break;
                        case 'completed': statusClass = 'status-completed'; break;
                        case 'canceled': statusClass = 'status-canceled'; break;
                    }
                    
                    requestElement.innerHTML = `
                        <h3>בקשה #${request.id}</h3>
                        <p><strong>סוג:</strong> ${getRequestType(request.type)}</p>
                        <p><strong>סטטוס:</strong> <span class="status-badge ${statusClass}">${getStatusText(request.status)}</span></p>
                        <p><strong>תאריך יצירה:</strong> ${formatDisplayDate(request.createdAt)}</p>
                        <p><strong>תיאור:</strong> ${request.description}</p>
                    `;
                    
                    resultsContainer.appendChild(requestElement);
                });
            }
            
            document.getElementById('statusResults').classList.remove('hidden');
        }
        
        // פונקציות לניהול מערכת
        function adminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // כאן בדרך כלל יהיה בדיקה מול שרת
            // לדוגמה נניח שהמשתמש הוא 'admin' והסיסמה '1234'
            if (username === 'admin' && password === '1234') {
                currentAdmin = { username, name: "מנהל מערכת" };
                document.getElementById('admin-panel').classList.remove('hidden');
                showAdminTab('requests');
                document.getElementById('admin-link').textContent = 'יציאה';
                document.getElementById('admin-link').onclick = adminLogout;
            } else {
                alert('שם משתמש או סיסמה לא נכונים');
            }
        }
        
        function adminLogout() {
            currentAdmin = null;
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('admin-link').textContent = 'כניסת עובד';
            document.getElementById('admin-link').onclick = function() { showSection('admin-login'); };
            showSection('home');
        }
        
        function loadAdminRequests() {
            const container = document.getElementById('adminRequestsList');
            container.innerHTML = '';
            
            // מיון לפי תאריך - הבקשות החדשות ביותר ראשונות
            const sortedRequests = [...requests].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedRequests.forEach(request => {
                const customer = customers.find(c => c.id === request.customerId);
                
                let statusClass = '';
                switch(request.status) {
                    case 'pending': statusClass = 'status-pending'; break;
                    case 'approved': statusClass = 'status-approved'; break;
                    case 'completed': statusClass = 'status-completed'; break;
                    case 'canceled': statusClass = 'status-canceled'; break;
                }
                
                const requestElement = document.createElement('div');
                requestElement.className = 'card';
                requestElement.innerHTML = `
                    <h3>בקשה #${request.id}</h3>
                    <p><strong>לקוח:</strong> ${customer.fullName} (${customer.idNumber})</p>
                    <p><strong>סוג:</strong> ${getRequestType(request.type)}</p>
                    <p><strong>סטטוס:</strong> <span class="status-badge ${statusClass}">${getStatusText(request.status)}</span></p>
                    <p><strong>תאריך יצירה:</strong> ${formatDisplayDate(request.createdAt)}</p>
                    <p><strong>תיאור:</strong> ${request.description}</p>
                    
                    <div style="margin-top: 1rem;">
                        <select id="status-${request.id}" class="btn-small" style="margin-right: 0.5rem;">
                            <option value="pending" ${request.status === 'pending' ? 'selected' : ''}>ממתין</option>
                            <option value="approved" ${request.status === 'approved' ? 'selected' : ''}>אושר</option>
                            <option value="completed" ${request.status === 'completed' ? 'selected' : ''}>הושלם</option>
                            <option value="canceled" ${request.status === 'canceled' ? 'selected' : ''}>בוטל</option>
                        </select>
                        
                        <button class="btn btn-small" onclick="updateRequestStatus('${request.id}')">עדכן סטטוס</button>
                    </div>
                `;
                
                container.appendChild(requestElement);
            });
        }
        
        function loadTechSchedule() {
            const techId = document.getElementById('techSelect').value;
            const date = document.getElementById('scheduleDate').value;
            
            if (!techId || !date) return;
            
            const tech = technicians.find(t => t.id === techId);
            if (!tech) return;
            
            const container = document.getElementById('techScheduleContainer');
            container.innerHTML = '<p>טוען לוח זמנים...</p>';
            
            // לדוגמה - ניצור לוח זמנים אם לא קיים
            if (!tech.schedule[date]) {
                tech.schedule[date] = {
                    available: [...workHours],
                    booked: []
                };
                saveData();
            }
            
            // הצגת לוח הזמנים
            setTimeout(() => {
                container.innerHTML = `
                    <h4>לוח זמנים עבור ${tech.name} - ${formatDisplayDate(date)}</h4>
                    <div class="schedule-grid">
                        ${workHours.map(hour => {
                            const isBooked = tech.schedule[date].booked.includes(hour);
                            return `
                                <div class="time-slot ${isBooked ? 'booked' : 'available'}" 
                                     onclick="${isBooked ? '' : `selectTimeSlot('${techId}', '${date}', '${hour}')`}">
                                    ${hour}
                                    ${isBooked ? '<br><small>תפוס</small>' : '<br><small>פנוי</small>'}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div id="selectedAppointment" style="margin-top: 2rem;"></div>
                `;
            }, 500);
        }
        
        function selectTimeSlot(techId, date, time) {
            const container = document.getElementById('selectedAppointment');
            
            // מציג את פרטי התור הנבחר
            container.innerHTML = `
                <div class="card">
                    <h4>תור חדש</h4>
                    <p><strong>טכנאי:</strong> ${getTechName(techId)}</p>
                    <p><strong>תאריך:</strong> ${formatDisplayDate(date)}</p>
                    <p><strong>שעה:</strong> ${time}</p>
                    
                    <div class="form-group">
                        <label for="appointmentRequest">בחר בקשה:</label>
                        <select id="appointmentRequest">
                            <option value="">בחר בקשה</option>
                            ${requests
                                .filter(r => r.status === 'approved' && !r.technician)
                                .map(r => `<option value="${r.id}">${r.id} - ${getRequestType(r.type)}</option>`)
                                .join('')}
                        </select>
                    </div>
                    
                    <button class="btn" onclick="bookAppointment('${techId}', '${date}', '${time}')">אשר תור</button>
                </div>
            `;
            
            // סימון השעה הנבחרת
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
                if (slot.textContent.includes(time)) {
                    slot.classList.add('selected');
                }
            });
        }
        
        function bookAppointment(techId, date, time) {
            const requestId = document.getElementById('appointmentRequest').value;
            if (!requestId) {
                alert('נא לבחור בקשה');
                return;
            }
            
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const tech = technicians.find(t => t.id === techId);
            if (!tech) return;
            
            // עדכון הבקשה
            request.status = 'approved';
            request.technician = techId;
            request.scheduledTime = `${date} ${time}`;
            request.updates.push({
                date: new Date().toISOString(),
                status: 'approved',
                technician: techId,
                scheduledTime: `${date} ${time}`,
                updatedBy: currentAdmin.name
            });
            
            // עדכון לוח הזמנים של הטכנאי
            if (!tech.schedule[date]) {
                tech.schedule[date] = {
                    available: [],
                    booked: []
                };
            }
            
            // הסרת השעה מהזמינים והוספה לתפוסים
            tech.schedule[date].available = tech.schedule[date].available.filter(h => h !== time);
            tech.schedule[date].booked.push(time);
            
            // שמירת השינויים
            saveData();
            
            // רענון התצוגה
            loadTechSchedule();
            loadAdminRequests();
            
            alert('התור נקבע בהצלחה!');
        }
        
        function updateRequestStatus(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const statusSelect = document.getElementById(`status-${requestId}`);
            const newStatus = statusSelect.value;
            
            request.status = newStatus;
            
            // הוספת עדכון להיסטוריה
            request.updates.push({
                date: new Date().toISOString(),
                status: newStatus,
                updatedBy: currentAdmin.name
            });
            
            // שמירת השינויים
            saveData();
            
            // רענון הרשימה
            loadAdminRequests();
            alert('הבקשה עודכנה בהצלחה!');
            sendStatusUpdateEmail(request);
        }
        
        // פונקציות עזר
        function formatDisplayDate(dateTimeStr) {
            if (!dateTimeStr) return '';
            const date = new Date(dateTimeStr);
            if (isNaN(date.getTime())) {
                // אם זה מחרוזת בתבנית YYYY-MM-DD
                if (dateTimeStr.includes(' ')) {
                    const [datePart, timePart] = dateTimeStr.split(' ');
                    const [year, month, day] = datePart.split('-');
                    return `${day}/${month}/${year} ${timePart}`;
                }
                return dateTimeStr;
            }
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        function getRequestType(type) {
            const types = {
                'new-installation': 'התקנה חדשה',
                'technical-issue': 'תקלה טכנית',
                'general-question': 'שאלה כללית'
            };
            return types[type] || type;
        }
        
        function getStatusText(status) {
            const statuses = {
                'pending': 'ממתין לאישור',
                'approved': 'מאושר',
                'completed': 'הושלם',
                'canceled': 'בוטל'
            };
            return statuses[status] || status;
        }
        
        function getTechName(techId) {
            const tech = technicians.find(t => t.id === techId);
            return tech ? tech.name : 'לא ידוע';
        }
        
        function saveData() {
            localStorage.setItem('requests', JSON.stringify(requests));
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('technicians', JSON.stringify(technicians));
        }
    
        function toggleCollapse(id) {
            const el = document.getElementById(id);
            if (el.style.display === "none") {
                el.style.display = "block";
            } else {
                el.style.display = "none";
            }
        }
        // פונקציה ששומרת את הלקוח והבקשה ב־Firestore
async function saveRequestToFirestore(request, customer) {
    try {
        // שמירת לקוח
        await db.collection("customers").doc(customer.id).set(customer);

        // שמירת בקשה
        await db.collection("requests").doc(request.id).set(request);

        console.log("הפנייה נשמרה בהצלחה ב־Firestore");
    } catch (error) {
        console.error("שגיאה בשמירה ל־Firestore:", error);
    }
}

        

    </script>

</body>
</html>